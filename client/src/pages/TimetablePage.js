import React, { useContext } from 'react';

import Container from 'react-bootstrap/Container';
import Tabs from 'react-bootstrap/Tabs';
import Tab from 'react-bootstrap/Tab';

import Timetable from '../components/Timetable';
import CourseOverview from '../components/CourseOverview';
import IndexEditOverview from '../components/IndexEditOverview';
import SavedPlansOverview from '../components/SavedPlansOverview';

import { CurrentPlanContext } from '../contexts/CurrentPlanContext';
import { TimetablePlansContext } from '../contexts/TimetablePlansContext';
import { SavedPlansContext } from '../contexts/SavedPlansContext';


function TimetablePage() {

  /* timetablePlans -> to have access to current index of generated timetablePlans when toggling
  currentPlan -> to check if currentPlan has been defined already
  setCurrentPlan -> to have access to current plan of timetablePlans when toggling to "Choose Plan"/"Edit Plan"
  savedPlans ->  to have access to array of savedPlans to display when toggling to "Save Plan" */
  const { timetablePlans } = useContext(TimetablePlansContext);
  const { savedPlans } = useContext(SavedPlansContext);
  const { currentPlan, setCurrentPlan } = useContext(CurrentPlanContext);

  //Allows toggling between plan generated by timetable generator or saved plans
  //Called when user clicks on either of the tabs
  const togglePlanToShow = (key) => {
    switch (key) {
      case "edit-plan":
      case "choose-plan":
        if (currentPlan.length !== 0) //Check if current plan is defined alr first
          setCurrentPlan(timetablePlans.timetables[timetablePlans.currentIndex]);
        break;
      case "save-plan":
        if (savedPlans.plans[savedPlans.currentIndex]) //Check if saved plan is defined alr first
          setCurrentPlan(savedPlans.plans[savedPlans.currentIndex]);
        break;
      default:
        break;
    }
  }

  return (
    <Container fluid className="px-0">
      <Timetable/>
      <Container fluid className ="pt-2">
          <Tabs 
          defaultActiveKey="choose-plan" 
          id="toggle-course-overview" 
          className="mb-3"
          onSelect={(key) => togglePlanToShow(key)}>
            <Tab eventKey="choose-plan" title="Choose Plan">
              <CourseOverview/>
            </Tab>
            <Tab eventKey="edit-plan" title="Edit Plan">
              <IndexEditOverview/>
            </Tab>
            <Tab eventKey="save-plan" title="Save Plan">
              <SavedPlansOverview/>
            </Tab>
          </Tabs>
      </Container>
    </Container>
  );
}

export default TimetablePage;